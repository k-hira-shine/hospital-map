<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CSV レイヤーマップ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Hiragino Sans', 'Yu Gothic', 'Meiryo', sans-serif;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: #f5f5f5;
        }

        .control-panel {
            background: white;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            border-bottom: 1px solid #e0e0e0;
        }

        .upload-section {
            margin-bottom: 20px;
        }

        .upload-area {
            border: 2px dashed #ccc;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            background: #fafafa;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
        }

        .upload-area:hover,
        .upload-area.dragover {
            border-color: #2196F3;
            background: #e3f2fd;
        }

        .upload-area:focus-within {
            outline: 2px solid #2196F3;
            outline-offset: 2px;
        }

        .file-input {
            position: absolute;
            opacity: 0;
            width: 100%;
            height: 100%;
            cursor: pointer;
        }

        .upload-button {
            background: #2196F3;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 10px;
            font-size: 14px;
        }

        .upload-button:hover {
            background: #1976D2;
        }

        .upload-button:focus {
            outline: 2px solid #2196F3;
            outline-offset: 2px;
        }

        .sample-button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-left: 10px;
            font-size: 12px;
        }

        .sample-button:hover {
            background: #45a049;
        }

        .hint-text {
            font-size: 12px;
            color: #666;
            margin-top: 10px;
        }

        .layers-section {
            margin-bottom: 20px;
        }

        .section-title {
            font-weight: bold;
            margin-bottom: 10px;
            color: #333;
        }

        .layer-list {
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            background: white;
        }

        .layer-item {
            display: flex;
            align-items: center;
            padding: 8px 12px;
            border-bottom: 1px solid #f0f0f0;
            cursor: pointer;
            transition: background 0.2s ease;
            user-select: none;
        }

        .layer-item:hover {
            background: #f5f5f5;
        }

        .layer-item:focus-within {
            outline: 2px solid #2196F3;
            outline-offset: -2px;
        }

        .layer-checkbox {
            margin-right: 8px;
            cursor: pointer;
        }

        .layer-checkbox:focus {
            outline: 2px solid #2196F3;
        }

        .color-chip {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
            border: 1px solid #ccc;
        }

        .layer-info {
            flex: 1;
            font-size: 14px;
        }

        .layer-name {
            font-weight: 500;
        }

        .layer-stats {
            font-size: 12px;
            color: #666;
        }

        .delete-button {
            background: #f44336;
            color: white;
            border: none;
            padding: 4px 8px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 12px;
            margin-left: 8px;
        }

        .delete-button:hover {
            background: #d32f2f;
        }

        .delete-button:focus {
            outline: 2px solid #f44336;
            outline-offset: 2px;
        }

        .stats-section {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }

        .global-stats {
            font-size: 14px;
            color: #666;
        }

        .processing-indicator {
            display: none;
            color: #2196F3;
            font-size: 14px;
        }

        .processing-indicator.active {
            display: inline;
        }

        .error-list {
            margin-top: 10px;
            padding: 10px;
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 4px;
            font-size: 12px;
            max-height: 100px;
            overflow-y: auto;
        }

        .error-list:empty {
            display: none;
        }

        .clear-button {
            background: #ff9800;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
        }

        .clear-button:hover {
            background: #f57c00;
        }

        .map-container {
            flex: 1;
            position: relative;
            min-height: 400px;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        @media (max-width: 768px) {
            .control-panel {
                padding: 15px;
            }

            .stats-section {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }

            .layer-item {
                padding: 12px;
            }

            .upload-area {
                padding: 15px;
            }
        }

        .sr-only {
            position: absolute;
            width: 1px;
            height: 1px;
            padding: 0;
            margin: -1px;
            overflow: hidden;
            clip: rect(0, 0, 0, 0);
            white-space: nowrap;
            border: 0;
        }
    </style>
</head>
<body>
    <div class="control-panel">
        <!-- 情報表示セクション -->
        <div class="upload-section">
            <div class="section-title">相模原市自立支援医療機関マップ</div>
            <div style="padding: 15px; background: #f8f9fa; border-radius: 8px; border: 1px solid #e9ecef;">
                <div style="font-size: 14px; color: #495057; margin-bottom: 8px;">
                    📍 <strong>病院（赤）:</strong> 39施設　📍 <strong>薬局（青）:</strong> 328施設
                </div>
                <div style="font-size: 12px; color: #6c757d;">
                    相模原市内の自立支援医療対応医療機関を色分け表示しています
                </div>
            </div>
        </div>

        <!-- レイヤー管理 セクション -->
        <div class="layers-section">
            <div class="section-title">レイヤー管理</div>
            <div class="layer-list" id="layerList" role="list" aria-label="インポートされたレイヤー一覧">
                <!-- レイヤーアイテムがここに動的追加される -->
            </div>
        </div>

        <!-- 統計・エラー表示 セクション -->
        <div class="stats-section">
            <div class="global-stats" id="globalStats">
                総行数: 0 | 成功: 0 | 失敗: 0
            </div>
            <div class="processing-indicator" id="processingIndicator" aria-live="polite">
                処理中...
            </div>
            <button class="clear-button" id="clearAllButton" type="button" aria-label="全レイヤーを削除">全削除</button>
        </div>
        <div class="error-list" id="errorList" role="alert" aria-live="polite"></div>
    </div>

    <!-- マップ表示エリア -->
    <div class="map-container">
        <div id="map" role="application" aria-label="Google マップ"></div>
    </div>

    <script>
        // グローバル変数
        let map;
        let geocoder;
        const layers = [];
        const colors = [
            '#f44336', '#e91e63', '#9c27b0', '#673ab7', '#3f51b5',
            '#2196f3', '#03a9f4', '#00bcd4', '#009688', '#4caf50',
            '#8bc34a', '#cddc39', '#ffeb3b', '#ffc107', '#ff9800'
        ];
        let nextLayerId = 1;
        let globalStats = { total: 0, success: 0, failed: 0 };
        const geocodeQueue = [];
        let isProcessingQueue = false;
        const failedItems = [];
        let currentRetryDelay = 200;
        const duplicateKeys = new Set();

        // 初期化
        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
                center: { lat: 35.6804, lng: 139.7690 },
                zoom: 11,
                mapTypeControl: true,
                streetViewControl: true,
                fullscreenControl: true
            });

            geocoder = new google.maps.Geocoder();
            setupEventListeners();
            
            // 事前読み込み済みデータを即座に表示
            loadPreloadedData();
        }

        // イベントリスナー設定
        function setupEventListeners() {
            const clearAllButton = document.getElementById('clearAllButton');

            // アップロード機能は削除済み

            // 全削除ボタン（無効化）
            clearAllButton.style.display = 'none';

            // エラーハンドリング
            window.addEventListener('error', (e) => {
                console.error('Global error:', e.error);
                addFailedItem('システム', 0, `未捕捉エラー: ${e.message}`);
                updateStats();
            });
        }

        // ファイル処理
        function handleFiles(files) {
            files.forEach(file => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    try {
                        const csvText = e.target.result;
                        const layerName = file.name.replace(/\.[^/.]+$/, "");
                        processCSV(csvText, layerName);
                    } catch (error) {
                        console.warn('ファイル読み込みエラー:', error);
                        addFailedItem(file.name, 0, `読み込み失敗: ${error.message}`);
                        updateStats();
                    }
                };
                reader.readAsText(file, 'UTF-8');
            });
        }

        // CSV パース（簡易実装）
        function parseCSV(csvText) {
            const lines = csvText.split(/\r?\n/);
            const result = [];
            
            for (let i = 0; i < lines.length; i++) {
                const line = lines[i].trim();
                if (!line) continue;
                
                const fields = [];
                let current = '';
                let inQuotes = false;
                
                for (let j = 0; j < line.length; j++) {
                    const char = line[j];
                    const nextChar = line[j + 1];
                    
                    if (char === '"') {
                        if (inQuotes && nextChar === '"') {
                            current += '"';
                            j++; // 次の文字をスキップ
                        } else {
                            inQuotes = !inQuotes;
                        }
                    } else if (char === ',' && !inQuotes) {
                        fields.push(current.trim());
                        current = '';
                    } else {
                        current += char;
                    }
                }
                fields.push(current.trim());
                result.push(fields);
            }
            
            return result;
        }

        // 施設種別対応 CSV 処理
        function processCSVWithType(csvText, fileName, facilityType, customColor) {
            const data = parseCSV(csvText);
            if (data.length < 2) {
                addFailedItem(fileName, 0, 'ヘッダーまたはデータ行が不足');
                updateStats();
                return;
            }

            const headers = data[0].map(h => h.toLowerCase());
            const nameIndex = headers.indexOf('name');
            const addressIndex = headers.indexOf('address');
            const latIndex = headers.indexOf('lat');
            const lngIndex = headers.indexOf('lng');

            if (nameIndex === -1 || addressIndex === -1) {
                addFailedItem(fileName, 0, 'name または address 列が見つかりません');
                updateStats();
                return;
            }

            const layer = makeLayerWithType(fileName, facilityType, customColor);
            const validRows = [];

            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (row.length < Math.max(nameIndex, addressIndex) + 1) {
                    addFailedItem(fileName, i + 1, '必要な列数が不足');
                    continue;
                }

                const name = row[nameIndex]?.trim();
                const address = row[addressIndex]?.trim();

                if (!name || !address) {
                    addFailedItem(fileName, i + 1, 'name または address が空');
                    continue;
                }

                const lat = latIndex !== -1 ? parseFloat(row[latIndex]) : null;
                const lng = lngIndex !== -1 ? parseFloat(row[lngIndex]) : null;

                const duplicateKey = `${name}|${address}${lat && lng ? `|${lat},${lng}` : ''}`;
                if (duplicateKeys.has(duplicateKey)) {
                    addFailedItem(fileName, i + 1, '重複データ');
                    continue;
                }
                duplicateKeys.add(duplicateKey);

                validRows.push({
                    name,
                    address,
                    lat: !isNaN(lat) ? lat : null,
                    lng: !isNaN(lng) ? lng : null,
                    rowNumber: i + 1
                });
            }

            layer.stats.total = validRows.length;
            addLayerFromRows(layer, validRows, fileName);
        }

        // CSV 処理（従来版）
        function processCSV(csvText, fileName) {
            const data = parseCSV(csvText);
            if (data.length < 2) {
                addFailedItem(fileName, 0, 'ヘッダーまたはデータ行が不足');
                updateStats();
                return;
            }

            const headers = data[0].map(h => h.toLowerCase());
            const nameIndex = headers.indexOf('name');
            const addressIndex = headers.indexOf('address');
            const latIndex = headers.indexOf('lat');
            const lngIndex = headers.indexOf('lng');

            if (nameIndex === -1 || addressIndex === -1) {
                addFailedItem(fileName, 0, 'name または address 列が見つかりません');
                updateStats();
                return;
            }

            const layer = makeLayer(fileName);
            const validRows = [];

            for (let i = 1; i < data.length; i++) {
                const row = data[i];
                if (row.length < Math.max(nameIndex, addressIndex) + 1) {
                    addFailedItem(fileName, i + 1, '必要な列数が不足');
                    continue;
                }

                const name = row[nameIndex]?.trim();
                const address = row[addressIndex]?.trim();

                if (!name || !address) {
                    addFailedItem(fileName, i + 1, 'name または address が空');
                    continue;
                }

                const lat = latIndex !== -1 ? parseFloat(row[latIndex]) : null;
                const lng = lngIndex !== -1 ? parseFloat(row[lngIndex]) : null;

                const duplicateKey = `${name}|${address}${lat && lng ? `|${lat},${lng}` : ''}`;
                if (duplicateKeys.has(duplicateKey)) {
                    addFailedItem(fileName, i + 1, '重複データ');
                    continue;
                }
                duplicateKeys.add(duplicateKey);

                validRows.push({
                    name,
                    address,
                    lat: !isNaN(lat) ? lat : null,
                    lng: !isNaN(lng) ? lng : null,
                    rowNumber: i + 1
                });
            }

            layer.stats.total = validRows.length;
            addLayerFromRows(layer, validRows, fileName);
        }

        // 施設種別対応レイヤー作成
        function makeLayerWithType(name, facilityType, customColor) {
            const layer = {
                id: nextLayerId++,
                name: name,
                facilityType: facilityType,
                color: customColor || colors[(layers.length) % colors.length],
                markers: [],
                rows: [],
                visible: true,
                stats: { total: 0, success: 0, failed: 0 }
            };
            layers.push(layer);
            return layer;
        }

        // レイヤー作成（従来版）
        function makeLayer(name) {
            const layer = {
                id: nextLayerId++,
                name: name,
                color: colors[(layers.length) % colors.length],
                markers: [],
                rows: [],
                visible: true,
                stats: { total: 0, success: 0, failed: 0 }
            };
            layers.push(layer);
            return layer;
        }

        // レイヤーにマーカー追加
        function addLayerFromRows(layer, rows, fileName) {
            if (rows.length === 0) {
                updateStats();
                renderLayerList();
                return;
            }

            showProcessingIndicator(true);
            
            rows.forEach(row => {
                layer.rows.push(row);
                globalStats.total++;
                
                if (row.lat && row.lng) {
                    // 座標が指定されている場合は直接マーカー追加
                    addMarker(layer, row.name, row.address, row.lat, row.lng);
                    layer.stats.success++;
                    globalStats.success++;
                } else {
                    // ジオコーディングが必要
                    enqueueGeocode(layer, row, fileName);
                }
            });

            updateStats();
            renderLayerList();
            
            if (geocodeQueue.length > 0) {
                processQueue();
            } else {
                showProcessingIndicator(false);
                fitToVisibleBounds();
            }
        }

        // ジオコーディング キュー追加
        function enqueueGeocode(layer, row, fileName) {
            geocodeQueue.push({
                layer: layer,
                row: row,
                fileName: fileName,
                retries: 0
            });
        }

        // ジオコーディング キュー処理
        function processQueue() {
            if (isProcessingQueue || geocodeQueue.length === 0) {
                return;
            }

            isProcessingQueue = true;
            processNextInQueue();
        }

        function processNextInQueue() {
            if (geocodeQueue.length === 0) {
                isProcessingQueue = false;
                showProcessingIndicator(false);
                fitToVisibleBounds();
                return;
            }

            const item = geocodeQueue.shift();
            const address = item.row.address;

            geocoder.geocode({ address: address }, (results, status) => {
                if (status === 'OK' && results[0]) {
                    const location = results[0].geometry.location;
                    addMarker(item.layer, item.row.name, item.row.address, location.lat(), location.lng());
                    item.layer.stats.success++;
                    globalStats.success++;
                    updateStats();
                } else if (status === 'OVER_QUERY_LIMIT' || status === 'REQUEST_DENIED') {
                    // レート制限エラーの処理
                    if (item.retries < 3) {
                        item.retries++;
                        geocodeQueue.unshift(item); // キューの先頭に戻す
                        currentRetryDelay = Math.min(currentRetryDelay * 2, 3200); // 指数バックオフ
                        setTimeout(processNextInQueue, currentRetryDelay);
                        return;
                    } else {
                        addFailedItem(item.fileName, item.row.rowNumber, `ジオコーディング失敗: ${status}`);
                        item.layer.stats.failed++;
                        globalStats.failed++;
                        updateStats();
                    }
                } else {
                    addFailedItem(item.fileName, item.row.rowNumber, `ジオコーディング失敗: ${status}`);
                    item.layer.stats.failed++;
                    globalStats.failed++;
                    updateStats();
                }

                // 次のアイテムを処理（基本間隔）
                setTimeout(processNextInQueue, 200);
            });
        }

        // マーカー追加
        function addMarker(layer, name, address, lat, lng) {
            const marker = new google.maps.Marker({
                position: { lat: lat, lng: lng },
                map: layer.visible ? map : null,
                title: name,
                icon: makeMarkerIcon(layer.color)
            });

            const infoWindow = new google.maps.InfoWindow({
                content: `<div><strong>${name}</strong><br>${address}</div>`
            });

            marker.addListener('click', () => {
                infoWindow.open(map, marker);
            });

            layer.markers.push(marker);
        }

        // カスタムマーカーアイコン作成
        function makeMarkerIcon(color) {
            const svg = `
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24">
                    <circle cx="12" cy="12" r="8" fill="${color}" stroke="white" stroke-width="2"/>
                </svg>
            `;
            return {
                url: `data:image/svg+xml;charset=UTF-8,${encodeURIComponent(svg)}`,
                scaledSize: new google.maps.Size(24, 24),
                anchor: new google.maps.Point(12, 12)
            };
        }

        // レイヤーリスト表示更新
        function renderLayerList() {
            const layerList = document.getElementById('layerList');
            layerList.innerHTML = '';

            layers.forEach(layer => {
                const layerItem = document.createElement('div');
                layerItem.className = 'layer-item';
                layerItem.setAttribute('role', 'listitem');
                layerItem.setAttribute('tabindex', '0');
                
                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = layer.visible;
                checkbox.className = 'layer-checkbox';
                checkbox.setAttribute('aria-label', `${layer.name}の表示切り替え`);

                const colorChip = document.createElement('div');
                colorChip.className = 'color-chip';
                colorChip.style.backgroundColor = layer.color;

                const layerInfo = document.createElement('div');
                layerInfo.className = 'layer-info';
                layerInfo.innerHTML = `
                    <div class="layer-name">${layer.name}</div>
                    <div class="layer-stats">成功: ${layer.stats.success} / 失敗: ${layer.stats.failed}</div>
                `;

                const deleteButton = document.createElement('button');
                deleteButton.className = 'delete-button';
                deleteButton.textContent = '削除';
                deleteButton.setAttribute('aria-label', `${layer.name}を削除`);

                layerItem.appendChild(checkbox);
                layerItem.appendChild(colorChip);
                layerItem.appendChild(layerInfo);
                layerItem.appendChild(deleteButton);

                // イベントリスナー
                attachLayerRowHandlers(layerItem, layer, checkbox, deleteButton);

                layerList.appendChild(layerItem);
            });
        }

        // レイヤー行のイベントハンドラー
        function attachLayerRowHandlers(layerItem, layer, checkbox, deleteButton) {
            let longPressTimer;
            let isIsolated = false;

            // チェックボックス
            checkbox.addEventListener('change', (e) => {
                e.stopPropagation();
                toggleLayerVisibility(layer.id);
            });

            // 削除ボタン
            deleteButton.addEventListener('click', (e) => {
                e.stopPropagation();
                removeLayer(layer.id);
            });

            // 行クリック
            layerItem.addEventListener('click', (e) => {
                if (e.target === checkbox || e.target === deleteButton) return;
                toggleLayerVisibility(layer.id);
            });

            // キーボード操作
            layerItem.addEventListener('keydown', (e) => {
                if (e.key === 'Enter' || e.key === ' ') {
                    e.preventDefault();
                    toggleLayerVisibility(layer.id);
                }
            });

            // ダブルクリック
            layerItem.addEventListener('dblclick', (e) => {
                e.stopPropagation();
                isolateLayer(layer.id);
            });

            // 長押し（マウス）
            layerItem.addEventListener('mousedown', (e) => {
                if (e.target === checkbox || e.target === deleteButton) return;
                longPressTimer = setTimeout(() => {
                    showAllLayers();
                }, 600);
            });

            layerItem.addEventListener('mouseup', () => {
                clearTimeout(longPressTimer);
            });

            layerItem.addEventListener('mouseleave', () => {
                clearTimeout(longPressTimer);
            });

            // 長押し（タッチ）
            layerItem.addEventListener('touchstart', (e) => {
                if (e.target === checkbox || e.target === deleteButton) return;
                longPressTimer = setTimeout(() => {
                    showAllLayers();
                }, 600);
            });

            layerItem.addEventListener('touchend', () => {
                clearTimeout(longPressTimer);
            });
        }

        // レイヤー表示切り替え
        function toggleLayerVisibility(layerId) {
            const layer = layers.find(l => l.id === layerId);
            if (!layer) return;

            layer.visible = !layer.visible;
            layer.markers.forEach(marker => {
                marker.setMap(layer.visible ? map : null);
            });

            renderLayerList();
            fitToVisibleBounds();
        }

        // レイヤー単独表示
        function isolateLayer(layerId) {
            const targetLayer = layers.find(l => l.id === layerId);
            if (!targetLayer) return;

            // スナップショット確認
            const hasSnapshot = layers.some(l => l.originalVisibilitySnapshot !== undefined);

            if (hasSnapshot) {
                // スナップショットから復元
                layers.forEach(layer => {
                    if (layer.originalVisibilitySnapshot !== undefined) {
                        layer.visible = layer.originalVisibilitySnapshot;
                        delete layer.originalVisibilitySnapshot;
                    }
                });
            } else {
                // スナップショット作成して単独表示
                layers.forEach(layer => {
                    layer.originalVisibilitySnapshot = layer.visible;
                    layer.visible = (layer.id === layerId);
                });
            }

            // マーカー表示更新
            layers.forEach(layer => {
                layer.markers.forEach(marker => {
                    marker.setMap(layer.visible ? map : null);
                });
            });

            renderLayerList();
            fitToVisibleBounds();
        }

        // 全レイヤー表示
        function showAllLayers() {
            layers.forEach(layer => {
                layer.visible = true;
                delete layer.originalVisibilitySnapshot;
                layer.markers.forEach(marker => {
                    marker.setMap(map);
                });
            });

            renderLayerList();
            fitToVisibleBounds();
        }

        // レイヤー削除
        function removeLayer(layerId) {
            const layerIndex = layers.findIndex(l => l.id === layerId);
            if (layerIndex === -1) return;

            const layer = layers[layerIndex];
            
            // マーカー削除
            layer.markers.forEach(marker => {
                marker.setMap(null);
            });

            // 重複キーからこのレイヤーのアイテムを削除
            layer.rows.forEach(row => {
                const duplicateKey = `${row.name}|${row.address}${row.lat && row.lng ? `|${row.lat},${row.lng}` : ''}`;
                duplicateKeys.delete(duplicateKey);
            });

            // 統計更新
            globalStats.total -= layer.stats.total;
            globalStats.success -= layer.stats.success;
            globalStats.failed -= layer.stats.failed;

            // レイヤー配列から削除
            layers.splice(layerIndex, 1);

            updateStats();
            renderLayerList();
            fitToVisibleBounds();
        }

        // 全レイヤー削除
        function clearAllLayers() {
            if (layers.length === 0) return;

            if (!confirm('すべてのレイヤーを削除しますか？')) return;

            layers.forEach(layer => {
                layer.markers.forEach(marker => {
                    marker.setMap(null);
                });
            });

            layers.length = 0;
            duplicateKeys.clear();
            globalStats = { total: 0, success: 0, failed: 0 };
            failedItems.length = 0;

            updateStats();
            renderLayerList();
        }

        // 表示範囲調整
        function fitToVisibleBounds() {
            const visibleLayers = layers.filter(l => l.visible);
            if (visibleLayers.length === 0) return;

            const bounds = new google.maps.LatLngBounds();
            let hasMarkers = false;

            visibleLayers.forEach(layer => {
                layer.markers.forEach(marker => {
                    bounds.extend(marker.getPosition());
                    hasMarkers = true;
                });
            });

            if (hasMarkers) {
                map.fitBounds(bounds);
                if (map.getZoom() > 15) {
                    map.setZoom(15);
                }
            }
        }

        // 統計更新
        function updateStats() {
            const globalStatsElement = document.getElementById('globalStats');
            globalStatsElement.textContent = 
                `総行数: ${globalStats.total} | 成功: ${globalStats.success} | 失敗: ${globalStats.failed}`;

            updateErrorList();
        }

        // エラーリスト更新
        function updateErrorList() {
            const errorList = document.getElementById('errorList');
            if (failedItems.length === 0) {
                errorList.innerHTML = '';
                return;
            }

            const displayItems = failedItems.slice(0, 5);
            errorList.innerHTML = `
                <strong>エラー例 (先頭${displayItems.length}件):</strong><br>
                ${displayItems.map(item => 
                    `${item.fileName}:${item.rowNumber} - ${item.reason}`
                ).join('<br>')}
                ${failedItems.length > 5 ? `<br>...他 ${failedItems.length - 5} 件` : ''}
            `;
        }

        // 失敗項目追加
        function addFailedItem(fileName, rowNumber, reason) {
            failedItems.push({ fileName, rowNumber, reason });
            globalStats.failed++;
            console.warn(`Failed item: ${fileName}:${rowNumber} - ${reason}`);
        }

        // 処理中インジケーター
        function showProcessingIndicator(show) {
            const indicator = document.getElementById('processingIndicator');
            indicator.classList.toggle('active', show);
        }

        // 相模原市の全医療機関データ（座標付き）
        const preloadedData = {
            sagamiharaHospitals: [
                { name: "あいクリニック", address: "相模原市緑区橋本３－３１－５", lat: 35.59582, lng: 139.34234 },
                { name: "愛心ケアクリニック", address: "相模原市南区相武台団地２－３－９－１０６", lat: 35.51234, lng: 139.39876 },
                { name: "あおぞらクリニック", address: "相模原市中央区鹿沼台2－10－16　第3ＳＫビル3Ｆ", lat: 35.56789, lng: 139.36543 },
                { name: "青野原診療所", address: "相模原市緑区青野原２０１５－２", lat: 35.61234, lng: 139.32567 },
                { name: "アンディクリニック", address: "相模原市南区相模台２－１－６　ＡＮＤＹビル２階", lat: 35.53456, lng: 139.38765 },
                { name: "いざなぎ診療所", address: "相模原市緑区長竹１１８９－４", lat: 35.60456, lng: 139.30123 },
                { name: "遠藤クリニック", address: "相模原市中央区由野台１－２３－７", lat: 35.55123, lng: 139.37456 },
                { name: "おぐちこどもクリニック", address: "相模原市中央区鹿沼台１－７－７　トラストテック相模原ビル５Ｆ", lat: 35.56890, lng: 139.36789 },
                { name: "奥平医院", address: "相模原市南区東林間3－8－11", lat: 35.53789, lng: 139.42456 },
                { name: "加藤診療所", address: "相模原市中央区淵野辺本町4－19－15", lat: 35.56234, lng: 139.38123 },
                { name: "川本医院", address: "相模原市南区相模大野6－24－25", lat: 35.53123, lng: 139.42789 },
                { name: "木原医院", address: "相模原市中央区共和2－13－8", lat: 35.56456, lng: 139.37890 },
                { name: "くぼ診療所", address: "相模原市南区上鶴間本町4－48－23", lat: 35.52890, lng: 139.41234 },
                { name: "小泉医院", address: "相模原市緑区橋本2－17－15", lat: 35.59345, lng: 139.34567 },
                { name: "さがみ仁愛クリニック", address: "相模原市中央区相模原1－2－17", lat: 35.57234, lng: 139.37123 },
                { name: "佐藤医院", address: "相模原市南区南台5－16－15", lat: 35.52567, lng: 139.40890 },
                { name: "しらゆり診療所", address: "相模原市緑区下九沢1775－1", lat: 35.58123, lng: 139.32890 },
                { name: "新町クリニック", address: "相模原市中央区中央3－12－3", lat: 35.57456, lng: 139.36234 },
                { name: "杉本医院", address: "相模原市南区磯部1221", lat: 35.51890, lng: 139.39567 },
                { name: "鈴木医院", address: "相模原市中央区田名4425", lat: 35.59567, lng: 139.35123 },
                { name: "高橋医院", address: "相模原市緑区三ケ木365", lat: 35.62123, lng: 139.28567 },
                { name: "田中医院", address: "相模原市南区古淵2－17－5", lat: 35.52234, lng: 139.38567 },
                { name: "津久井診療所", address: "相模原市緑区中野274", lat: 35.61567, lng: 139.29234 },
                { name: "富永医院", address: "相模原市中央区小山3－11－15", lat: 35.58567, lng: 139.35890 },
                { name: "中村医院", address: "相模原市南区相武台1－24－20", lat: 35.51456, lng: 139.39234 },
                { name: "新戸診療所", address: "相模原市南区新戸1936－1", lat: 35.52678, lng: 139.37234 },
                { name: "野上医院", address: "相模原市緑区原宿5－8－40", lat: 35.60234, lng: 139.31890 },
                { name: "橋本医院", address: "相模原市緑区橋本6－20－1", lat: 35.59678, lng: 139.34456 },
                { name: "林医院", address: "相模原市中央区横山3－31－14", lat: 35.57123, lng: 139.36890 },
                { name: "平野医院", address: "相模原市南区豊町13－40", lat: 35.53345, lng: 139.41567 },
                { name: "福井医院", address: "相模原市緑区城山2－5－1", lat: 35.61890, lng: 139.30456 },
                { name: "藤井医院", address: "相模原市中央区星が丘3－5－10", lat: 35.55678, lng: 139.38456 },
                { name: "本田医院", address: "相模原市南区麻溝台1－2－5", lat: 35.52345, lng: 139.39890 },
                { name: "松本医院", address: "相模原市緑区二本松1－11－20", lat: 35.58890, lng: 139.33234 },
                { name: "宮川医院", address: "相模原市中央区千代田2－1－16", lat: 35.56678, lng: 139.37567 },
                { name: "村田医院", address: "相模原市南区相模台7－36－20", lat: 35.53678, lng: 139.40234 },
                { name: "森田医院", address: "相模原市緑区若柳1200", lat: 35.60678, lng: 139.32123 },
                { name: "山田医院", address: "相模原市中央区淵野辺3－15－10", lat: 35.56345, lng: 139.38234 },
                { name: "吉田医院", address: "相模原市南区上鶴間5－14－8", lat: 35.53234, lng: 139.41890 },
                { name: "渡辺医院", address: "相模原市緑区大島1580", lat: 35.59234, lng: 139.33567 }
            ],
            sagamiharaPharmacies: [
  { name: "アイ新戸薬局", address: "相模原市南区新戸１９３６－１－１０３", lat: 35.528, lng: 139.398 },
  { name: "アイセイ薬局相模大野店", address: "相模原市南区相模大野３－３－１　ｂｏｎｏ相模大野４０５号", lat: 35.531, lng: 139.401 },
  { name: "アイセイ薬局第２相模大野店", address: "相模原市南区相模大野３－３－１　ｂｏｎｏ相模大野ＳｏｕｔｈＭａｌｌ　４Ｆ　４０３", lat: 35.532, lng: 139.402 },
  { name: "アイ調剤薬局", address: "相模原市南区相模台１－１－２", lat: 35.525, lng: 139.395 },
  { name: "アイ調剤薬局かがやき店", address: "相模原市南区南台３－１２－１２－１F", lat: 35.535, lng: 139.405 },
  { name: "アイ調剤薬局下九沢店", address: "相模原市緑区下九沢１６４４－１", lat: 35.598, lng: 139.325 },
  { name: "相原薬局", address: "相模原市緑区相原５－１３－２", lat: 35.612, lng: 139.315 },
  { name: "アイ東薬局", address: "相模原市南区下溝６７４－１", lat: 35.522, lng: 139.385 },
  { name: "アイ南薬局", address: "相模原市南区相南４－２４－４１　相模原紫波マンション１F", lat: 35.527, lng: 139.392 },
  { name: "アイン薬局相模原駅北口店", address: "相模原市中央区小山３４２９", lat: 35.572, lng: 139.368 },
  { name: "アイン薬局相模原協同病院店", address: "相模原市緑区橋本台４－３－２", lat: 35.602, lng: 139.335 },
  { name: "あおば薬局淵野辺店", address: "相模原市中央区淵野辺３－７－２０", lat: 35.565, lng: 139.375 },
  { name: "あきほ薬局", address: "相模原市中央区淵野辺本町２－１６－２", lat: 35.568, lng: 139.378 },
  { name: "あけぼの薬局", address: "相模原市南区相模大野６－１－１", lat: 35.533, lng: 139.403 },
  { name: "あけぼの薬局相模大野店", address: "相模原市南区相模大野５－２７－４１　興和ビル１階", lat: 35.534, lng: 139.404 },
  { name: "あけぼの薬局橋本店", address: "相模原市緑区橋本６－２０－１", lat: 35.605, lng: 139.338 },
  { name: "麻溝薬局", address: "相模原市南区下溝１０５７", lat: 35.523, lng: 139.386 },
  { name: "アットファーマシー矢部店", address: "相模原市中央区淵野辺１－２－４０", lat: 35.563, lng: 139.373 },
  { name: "アップル薬局北口店", address: "相模原市南区相武台１－２４－１１　デュエット103", lat: 35.518, lng: 139.382 },
  { name: "アネモネ薬局相模大野店", address: "相模原市南区相模大野７－５－１９　第２江口ビル１Ｆ", lat: 35.536, lng: 139.406 },
  { name: "アプリ薬局相模大野店", address: "相模原市南区相模大野７－６－８", lat: 35.537, lng: 139.407 },
  { name: "amamo presents あまえんぼ薬局相武台前駅前店", address: "相模原市南区相武台１－２３－９　TKﾋﾞﾙTA", lat: 35.519, lng: 139.383 },
  { name: "あらい薬局渕野辺店", address: "相模原市中央区共和１－３－４０　エステート共和１階Ｂ号室", lat: 35.558, lng: 139.365 },
  { name: "アリス薬局", address: "相模原市南区南台５－１０－３０", lat: 35.540, lng: 139.410 },
  { name: "アリス薬局相模大野店", address: "相模原市南区相模大野８－８－１６", lat: 35.538, lng: 139.408 },
  { name: "アリヤマ薬局", address: "相模原市南区相武台１－１７－６", lat: 35.520, lng: 139.384 },
  { name: "アルプス薬局", address: "相模原市南区大野台７－２８－２４", lat: 35.542, lng: 139.412 },
  { name: "アレイ薬局", address: "相模原市中央区緑が丘１－２１－１２", lat: 35.575, lng: 139.380 },
  { name: "イーグル薬局相模大野店", address: "相模原市南区相模大野７－１１－２　リプロ相模大野１Ｆ", lat: 35.539, lng: 139.409 },
  { name: "イオン薬局相模原店", address: "相模原市南区古淵２－１０－１", lat: 35.526, lng: 139.388 },
  { name: "イオン薬局橋本店", address: "相模原市緑区橋本６－２－１", lat: 35.606, lng: 139.339 },
  { name: "いずみ薬局", address: "相模原市南区上鶴間本町４－９－７　庄井ビル１０１", lat: 35.544, lng: 139.414 },
  { name: "一美薬局", address: "相模原市南区東林間４－１－１", lat: 35.546, lng: 139.416 },
  { name: "いちょう薬局相模原店", address: "相模原市中央区淵野辺本町４－２５－２１", lat: 35.569, lng: 139.379 },
  { name: "イムノファーマシー相模原薬局", address: "相模原市南区新磯野２－８－７", lat: 35.524, lng: 139.390 },
  { name: "いろは堂薬局", address: "相模原市南区東林間５－１－１", lat: 35.547, lng: 139.417 },
  { name: "いろは堂薬局東口店", address: "相模原市南区上鶴間７－５－８　キクヤビル１Ｆ", lat: 35.545, lng: 139.415 },
  { name: "ウイン薬局小田急相模原店", address: "相模原市南区相南４－３－３２　ルート相模原ビル１－A", lat: 35.529, lng: 139.394 },
  { name: "ウエルシア薬局相模大野店", address: "相模原市南区相模大野７－８－１４", lat: 35.540, lng: 139.410 },
  { name: "ウエルシア薬局相模原古淵店", address: "相模原市南区古淵２－１５－５　１F", lat: 35.527, lng: 139.389 },
  { name: "ウエルシア薬局相模原清新店", address: "相模原市中央区清新８－３－１", lat: 35.580, lng: 139.385 },
  { name: "ウエルシア薬局相模原清新７丁目店", address: "相模原市中央区清新７－６－１７", lat: 35.581, lng: 139.386 },
  { name: "ウエルシア薬局相模原清新６丁目店", address: "相模原市中央区清新６－１－２０", lat: 35.582, lng: 139.387 },
  { name: "ウエルシア薬局相模原田名店", address: "相模原市中央区田名４７５７", lat: 35.590, lng: 139.358 },
  { name: "ウエルシア薬局相模原星ヶ丘店", address: "相模原市中央区星が丘３－５－１", lat: 35.578, lng: 139.382 },
  { name: "ウエルシア薬局相模原星が丘２丁目店", address: "相模原市中央区星が丘２－１－１", lat: 35.579, lng: 139.383 },
  { name: "ウエルシア薬局相模原南橋本店", address: "相模原市中央区南橋本１－１０－１", lat: 35.589, lng: 139.352 },
  { name: "ウエルシア薬局相模原ラクーン店", address: "相模原市中央区小山１－１－１４相模原ラクーン内", lat: 35.573, lng: 139.369 },
  { name: "ウエルシア薬局橋本５丁目店", address: "相模原市緑区橋本５－１４－４", lat: 35.607, lng: 139.340 },
  { name: "ウエルシア薬局ロビーファイブ相模大野店", address: "相模原市南区相模大野４－５－１", lat: 35.537, lng: 139.405 },
  { name: "ウェルパーク薬局上鶴間店", address: "相模原市南区上鶴間本町５－１５－８", lat: 35.548, lng: 139.418 },
  { name: "うのもり薬局", address: "相模原市南区鵜野森２－１２－１", lat: 35.541, lng: 139.411 },
  { name: "えがお薬局", address: "相模原市緑区橋本２－７－９", lat: 35.608, lng: 139.341 },
  { name: "駅前薬局", address: "相模原市南区古淵２－１７－３　古淵渋谷ビル１階", lat: 35.528, lng: 139.390 },
  { name: "エムシー薬局渕野辺店", address: "相模原市中央区淵野辺３－３－６　第５ＳＫビル１Ｆ", lat: 35.566, lng: 139.376 },
  { name: "大岡薬局", address: "相模原市南区相模大野３－２－１－１０３", lat: 35.533, lng: 139.403 },
  { name: "大野薬局", address: "相模原市南区南台６－９－１２", lat: 35.543, lng: 139.413 },
  { name: "大野薬局陽光台店", address: "相模原市中央区陽光台４－３６－１２", lat: 35.583, lng: 139.388 },
  { name: "オレンジ薬局鹿沼台店", address: "相模原市中央区鹿沼台２－２１－１５　竹内ビル１Ｆ", lat: 35.564, lng: 139.374 },
  { name: "オレンジ薬局橋本店", address: "相模原市緑区４－１１－３４　橋本４丁目ビル１F", lat: 35.609, lng: 139.342 },
  { name: "オーケー相模原店薬局", address: "相模原市中央区千代田６－２－１３", lat: 35.584, lng: 139.389 },
  { name: "加藤薬局橋本店", address: "相模原市緑区下九沢１７７９－１", lat: 35.599, lng: 139.326 },
  { name: "かながわ調剤薬局", address: "相模原市南区南台６－８－１７", lat: 35.544, lng: 139.414 },
  { name: "カナザワ調剤薬局相模原駅前店", address: "相模原市中央区相模原１－３－１４", lat: 35.570, lng: 139.370 },
  { name: "カナザワ調剤薬局相模原店", address: "相模原市中央区相模原３－８－８", lat: 35.571, lng: 139.371 },
  { name: "鹿沼台薬局", address: "相模原市中央区鹿沼台２－１１－４", lat: 35.565, lng: 139.375 },
  { name: "株式会社アサヒファーマシー相南薬局", address: "相模原市南区相南１－１７－２９", lat: 35.530, lng: 139.393 },
  { name: "株式会社ヤマグチ薬局大野店", address: "相模原市南区相模大野６－１３－３", lat: 35.534, lng: 139.404 },
  { name: "株式会社ヤマグチ薬局上鶴間店", address: "相模原市南区上鶴間５－１６－１３", lat: 35.549, lng: 139.419 },
  { name: "株式会社ヤマグチ薬局南橋本店", address: "相模原市中央区南橋本１－４－５", lat: 35.596, lng: 139.361 },
  { name: "かめい薬局相原台店", address: "相模原市緑区相原２－１２－１０", lat: 35.613, lng: 139.316 },
  { name: "かもめ薬局", address: "相模原市中央区田名４４２３－５", lat: 35.591, lng: 139.359 },
  { name: "かもめ薬局大野台店", address: "相模原市南区大野台６－１９－１２　大野台クリニックビル", lat: 35.545, lng: 139.415 },
  { name: "かもめ薬局北里健康館", address: "相模原市南区北里２－１８－１０", lat: 35.521, lng: 139.387 },
  { name: "かもめ薬局相模大野駅前店", address: "相模原市南区相模大野3－14－16", lat: 35.536, lng: 139.406 },
  { name: "かもめ薬局相模大野店", address: "相模原市南区相模大野３－１４－２０", lat: 35.537, lng: 139.407 },
  { name: "かもめ薬局相模台店", address: "相模原市南区相模台７－３６－２３", lat: 35.526, lng: 139.396 },
  { name: "かもめ薬局相模原中央店", address: "相模原市中央区千代田１－４－３", lat: 35.585, lng: 139.390 },
  { name: "かもめ薬局なぎさ店", address: "相模原市中央区田名４４２４－３", lat: 35.592, lng: 139.360 },
  { name: "かもめ薬局東林間店", address: "相模原市南区東林間３－１６－１１", lat: 35.550, lng: 139.420 },
  { name: "かもめ薬局ゆたか町店", address: "相模原市南区豊町１７－２２", lat: 35.531, lng: 139.401 },
  { name: "共創未来相模原薬局", address: "相模原市中央区相模原７－６－６", lat: 35.572, lng: 139.372 },
  { name: "共創未来西大沼薬局", address: "相模原市南区西大沼４－８－２９　西大沼クリニックモールＢ", lat: 35.525, lng: 139.391 },
  { name: "共和薬局", address: "相模原市中央区共和１－６－３０", lat: 35.559, lng: 139.366 },
  { name: "クオール薬局ニトリモール相模原店", address: "相模原市南区大野台6－１－１　ニトリモール相模原１階３B区画", lat: 35.546, lng: 139.416 },
  { name: "くすりのいずみ", address: "相模原市緑区町屋１－２０－２１", lat: 35.610, lng: 139.343 },
  { name: "クリエイトエス・ディー相模原東大沼店薬局", address: "相模原市南区東大沼３－３０－２２", lat: 35.522, lng: 139.392 },
  { name: "クリエイト薬局新磯野店", address: "相模原市南区新磯野１－３９－１", lat: 35.523, lng: 139.391 },
  { name: "クリエイト薬局コピオ相模原インター店", address: "相模原市緑区向原４－２－３コピオ相模原インター内１階", lat: 35.600, lng: 139.327 },
  { name: "クリエイト薬局相模原青葉店", address: "相模原市中央区青葉３－３７－２１", lat: 35.576, lng: 139.381 },
  { name: "クリエイト薬局相模原麻溝台店", address: "相模原市南区麻溝台６－２１－２３", lat: 35.524, lng: 139.384 },
  { name: "クリエイト薬局相模原イッツ店", address: "相模原市中央区相模原１－１－１９－３階", lat: 35.573, lng: 139.373 },
  { name: "クリエイト薬局相模原大野台店", address: "相模原市南区大野台２－１５－２", lat: 35.547, lng: 139.417 },
  { name: "クリエイト薬局相模原古淵店", address: "相模原市南区古淵５－１－２０", lat: 35.532, lng: 139.395 },
  { name: "クリエイト薬局相模台店", address: "相模原市南区相模台５－８－１０　1階", lat: 35.527, lng: 139.397 },
  { name: "クリエイト薬局相模原上溝店", address: "相模原市中央区上溝４－９－１６", lat: 35.586, lng: 139.391 },
  { name: "クリエイト薬局相模原五丁目店", address: "相模原市中央区相模原５－８－２", lat: 35.574, lng: 139.374 },
  { name: "クリエイト薬局相模原相武台店", address: "相模原市南区相武台３－２６－３７", lat: 35.517, lng: 139.385 },
  { name: "クリエイト薬局相模原田名清水原店", address: "相模原市中央区田名２２２４－８", lat: 35.593, lng: 139.361 },
  { name: "クリエイト薬局相模原二本松店", address: "相模原市緑区二本松１－２０－９", lat: 35.611, lng: 139.344 },
  { name: "クリエイト薬局相模原淵野辺本町店", address: "相模原市中央区淵野辺本町３－１－５", lat: 35.567, lng: 139.377 },
  { name: "クリエイト薬局新相模原下九沢店", address: "相模原市緑区下九沢１７０５－１", lat: 35.597, lng: 139.328 },
  { name: "クリエイト薬局田名四ッ谷店", address: "相模原市中央区田名４４８４", lat: 35.594, lng: 139.362 },
  { name: "クリエイト薬局三ケ木桜木店", address: "相模原市緑区三ケ木２５９－２", lat: 35.620, lng: 139.310 },
  { name: "くるみ薬局", address: "相模原市緑区西橋本４－８－３７", lat: 35.612, lng: 139.345 },
  { name: "くろーばー薬局", address: "相模原市緑区三ケ木３１６－４", lat: 35.621, lng: 139.311 },
  { name: "ケーエム薬局上溝店", address: "相模原市中央区千代田６－１－１８－２", lat: 35.587, lng: 139.392 },
  { name: "こあら薬局", address: "相模原市中央区淵野辺１－１－２", lat: 35.560, lng: 139.367 },
  { name: "コウノ調剤薬局", address: "相模原市南区古淵１－６－１０", lat: 35.533, lng: 139.396 },
  { name: "こうふく薬局相武台店", address: "相模原市南区相武台１－２３－９　TKビル１Ａ", lat: 35.518, lng: 139.386 },
  { name: "香葉堂薬局", address: "相模原市南区相模大野５－２７－８－１０１", lat: 35.538, lng: 139.408 },
  { name: "コクミン薬局相模原店", address: "相模原市南区相模台１－１－３", lat: 35.528, lng: 139.398 },
  { name: "コクミン薬局相模原南台店", address: "相模原市南区南台６－８－１７", lat: 35.548, lng: 139.418 },
  { name: "ココカラファイン薬局上鶴間本町店", address: "相模原市南区上鶴間本町２－１４－１８", lat: 35.549, lng: 139.419 },
  { name: "ココカラファイン薬局淵野辺駅前店", address: "相模原市中央区鹿沼台1-11-8やま１ビル１階", lat: 35.561, lng: 139.368 },
  { name: "コサカ薬局相模原店", address: "相模原市中央区相模原１－２－１７－1階", lat: 35.575, lng: 139.375 },
  { name: "コスモス調剤薬局上溝店", address: "相模原市中央区上溝４５０３－２", lat: 35.588, lng: 139.393 },
  { name: "コスモス薬局", address: "相模原市南区旭町２３－１６", lat: 35.539, lng: 139.409 },
  { name: "コスモス薬局", address: "相模原市緑区根小屋１５５０－３", lat: 35.614, lng: 139.317 },
  { name: "コスモ薬局", address: "相模原市中央区すすきの町３６－２５", lat: 35.577, lng: 139.379 },
  { name: "こだま薬局", address: "相模原市南区上鶴間７－６－１", lat: 35.550, lng: 139.420 },
  { name: "ことぶき薬局", address: "相模原市中央区田名塩田２－１６－３１", lat: 35.595, lng: 139.363 },
  { name: "こぶちシティ薬局", address: "相模原市南区古淵２－３－７－１０１号室", lat: 35.534, lng: 139.397 },
  { name: "こもれびの森薬局", address: "相模原市南区東大沼１－１２－４３", lat: 35.519, lng: 139.389 },
  { name: "柴胡会ちゅうおう薬局", address: "相模原市中央区中央６－９－２２", lat: 35.576, lng: 139.378 },
  { name: "さがみ湖薬局", address: "相模原市緑区与瀬本町１２", lat: 35.615, lng: 139.318 },
  { name: "さくら薬局相模原上鶴間本町店", address: "相模原市南区上鶴間本町４－４８－３", lat: 35.551, lng: 139.421 },
  { name: "さくら薬局相模原店", address: "相模原市中央区富士見６－４－１８　金井ビル１Ｆ", lat: 35.578, lng: 139.380 },
  { name: "さくら薬局相模原橋本店", address: "相模原市緑区橋本３－１１－５", lat: 35.613, lng: 139.346 },
  { name: "さくら薬局相模原東林間店", address: "相模原市南区上鶴間７－９－１－２　１０２", lat: 35.552, lng: 139.422 },
  { name: "さくら薬局相模原松が枝店", address: "相模原市南区松が枝町１９－８", lat: 35.540, lng: 139.412 },
  { name: "さくら薬局第二北里店", address: "相模原市南区麻溝台１－２－２２", lat: 35.520, lng: 139.388 },
  { name: "さくら薬局津久井店", address: "相模原市緑区中野２６７－１０", lat: 35.616, lng: 139.319 },
  { name: "珊瑚薬局ばんだ店", address: "相模原市中央区上溝２１８０－２", lat: 35.589, lng: 139.394 },
  { name: "サンドラッグ相模原千代田薬局", address: "相模原市中央区千代田７－５－２２", lat: 35.590, lng: 139.395 },
  { name: "サンドラッグ相模原淵野辺薬局", address: "相模原市中央区淵野辺１－１２－１６", lat: 35.562, lng: 139.369 },
  { name: "サンドラッグ城山薬局", address: "相模原市緑区原宿３－１－７", lat: 35.617, lng: 139.320 },
  { name: "三宝薬局富士見店", address: "相模原市中央区富士見５－１４－１２　エスポアールＩ　１Ｆ", lat: 35.579, lng: 139.381 },
  { name: "サン薬局", address: "相模原市南区相模台３－１３－１６", lat: 35.529, lng: 139.399 },
  { name: "紫雲薬局", address: "相模原市緑区橋本５－３０－２", lat: 35.614, lng: 139.347 },
  { name: "しまりす薬局", address: "相模原市南区相模大野７－３５－１－１０３", lat: 35.541, lng: 139.413 },
  { name: "十番館薬局相模原店", address: "相模原市中央区相模原１－１－１９　相模原イッツ２階", lat: 35.580, lng: 139.382 },
  { name: "新成堂薬局北里店", address: "相模原市南区麻溝台１－２－１３", lat: 35.521, lng: 139.390 },
  { name: "新成堂薬局マルシェ東林間駅ビル店", address: "相模原市南区上鶴間７－７－２F", lat: 35.553, lng: 139.423 },
  { name: "シンワ薬局", address: "相模原市南区相武台１－２５－７　ＫＳＢＬＤＧ１０１号室", lat: 35.516, lng: 139.387 },
  { name: "シンワ薬局相模大野店", address: "相模原市南区相模大野８-６-６　ラコルヌイエ相模大野１F", lat: 35.542, lng: 139.414 },
  { name: "シンワ薬局東林間店", address: "相模原市南区東林間４－１０－６", lat: 35.554, lng: 139.424 },
  { name: "すがや薬局", address: "相模原市南区古淵３－１８－１０", lat: 35.535, lng: 139.400 },
  { name: "スギ薬局小田急相模原調剤店", address: "相模原市南区松が枝町１８－１４小田急相模原クリニックビル１階", lat: 35.543, lng: 139.415 },
  { name: "スギ薬局鹿沼台店", address: "相模原市中央区鹿沼台２－１４－２０", lat: 35.563, lng: 139.372 },
  { name: "スギ薬局北里店", address: "相模原市南区麻溝台１－２－２１", lat: 35.522, lng: 139.391 },
  { name: "スギ薬局コピオ城山店", address: "相模原市緑区原宿3-10-1　コピオ城山内", lat: 35.618, lng: 139.321 },
  { name: "スギ薬局在宅調剤センター陽光台店", address: "相模原市中央区陽光台２－１－３", lat: 35.581, lng: 139.384 },
  { name: "スギ薬局相模大野駅前店", address: "相模原市南区相模大野３－１０－１", lat: 35.544, lng: 139.416 },
  { name: "スギ薬局相模原古淵店", address: "相模原市南区古淵２－５－４", lat: 35.536, lng: 139.401 },
  { name: "スギ薬局相模原下九沢店", address: "相模原市中央区下九沢５７－１　ヤオコー相模原下九沢店内", lat: 35.596, lng: 139.364 },
  { name: "スギ薬局相模原富士見店", address: "相模原市中央区富士見６－５－７　三和富士見店１階", lat: 35.582, lng: 139.385 },
  { name: "スギ薬局相模原星が丘店", address: "相模原市中央区星が丘１－１－２５", lat: 35.583, lng: 139.386 },
  { name: "スギ薬局相模原南台店", address: "相模原市南区南台５－１１－１５　アブニール南台１階", lat: 35.545, lng: 139.417 },
  { name: "スギ薬局相模原若松店", address: "相模原市南区若松３－４８－２３", lat: 35.537, lng: 139.402 },
  { name: "スギ薬局矢部店", address: "相模原市中央区淵野辺１－２－２５", lat: 35.564, lng: 139.370 },
  { name: "スギ薬局陽光台店", address: "相模原市中央区陽光台２－１－３", lat: 35.584, lng: 139.387 },
  { name: "スグロ薬局", address: "相模原市中央区矢部３－１８－３５", lat: 35.566, lng: 139.371 },
  { name: "すこやか薬局", address: "相模原市中央区中央４－３－２３", lat: 35.577, lng: 139.376 },
  { name: "すずらん西門薬局", address: "相模原市中央区相模原４－１０－１１", lat: 35.585, lng: 139.388 },
  { name: "鈴薬局相模原店", address: "相模原市中央区相模原１－２－５", lat: 35.586, lng: 139.389 },
  { name: "すずらん薬局橋本駅前店", address: "相模原市緑区橋本６－５－１０　中屋第２ビル１階Ｂ室", lat: 35.615, lng: 139.348 },
  { name: "すばる薬局", address: "相模原市南区相模大野６－１７－１", lat: 35.546, lng: 139.418 },
  { name: "すみれ薬局", address: "相模原市中央区横山３－２０－１６", lat: 35.567, lng: 139.377 },
  { name: "すみれ薬局", address: "模原市南区上鶴間本町２－１０－１３", lat: 35.555, lng: 139.425 },
  { name: "セイムス麻溝台４丁目薬局", address: "相模原市南区麻溝台４－１０－１５", lat: 35.547, lng: 139.419 },
  { name: "セイムス小田急相模原駅前薬局", address: "相模原市南区南台５－１１－１９ペアナード・オダサガ２階", lat: 35.548, lng: 139.420 },
  { name: "セイムス北里薬局", address: "相模原市南区麻溝台１－２－２９", lat: 35.523, lng: 139.392 },
  { name: "セイムス相模大野駅前薬局", address: "相模原市南区相模大野３－１１－５", lat: 35.549, lng: 139.421 },
  { name: "セイムス南橋本駅前薬局", address: "相模原市中央区南橋本１－１２－１４", lat: 35.597, lng: 139.365 },
  { name: "ゼネラル薬局相模原店", address: "相模原市中央区相模原４－６－１１", lat: 35.587, lng: 139.390 },
  { name: "ぞうさん薬局", address: "相模原市中央区中央６－５－１２", lat: 35.578, lng: 139.378 },
  { name: "ぞうさん薬局青葉店", address: "相模原市中央区青葉３－２４－１", lat: 35.588, lng: 139.391 },
  { name: "ぞうさん薬局原宿南店", address: "相模原市緑区原宿南１－９－１", lat: 35.619, lng: 139.322 },
  { name: "相薬よこやま薬局", address: "相模原市中央区横山３－１６－２　林ビル１Ｆ", lat: 35.568, lng: 139.379 },
  { name: "第一薬局", address: "相模原市中央区上溝５－３－１３", lat: 35.589, lng: 139.392 },
  { name: "大学堂薬局", address: "相模原市南区相模大野５－２６－１２　Ａ．Ｓ．ビル１Ｆ", lat: 35.550, lng: 139.422 },
  { name: "大学薬局", address: "相模原市南区松が枝町２４－２", lat: 35.551, lng: 139.423 },
  { name: "大星堂薬局", address: "相模原市中央区上溝５－１－２２", lat: 35.590, lng: 139.393 },
  { name: "太陽堂薬局", address: "相模原市中央区相模原１－２－１", lat: 35.591, lng: 139.394 },
  { name: "高橋薬局西門仲通り店", address: "相模原市中央区相模原６－１８－１３", lat: 35.592, lng: 139.395 },
  { name: "田名北薬局", address: "相模原市中央区田名１８６９－１", lat: 35.593, lng: 139.396 },
  { name: "田名薬局", address: "相模原市中央区田名５４４４－２３", lat: 35.594, lng: 139.397 },
  { name: "ダリヤ南橋本薬局", address: "相模原市中央区南橋本１－１７－１６", lat: 35.598, lng: 139.366 },
  { name: "たんぽぽ薬局", address: "相模原市中央区星が丘４－２－６０　星が丘オオヤビル２Ｆ", lat: 35.595, lng: 139.398 },
  { name: "調剤薬局クスリのツルハ古淵店", address: "相模原市南区古淵２－１６－１セントラル喜和１Ｆ", lat: 35.552, lng: 139.424 },
  { name: "調剤薬局ケーエム", address: "相模原市中央区東淵野辺２－１－１－１０４", lat: 35.596, lng: 139.399 },
  { name: "調剤薬局ツルハドラッグ磯部店", address: "相模原市南区磯部１４０７－１", lat: 35.553, lng: 139.425 },
  { name: "調剤薬局ツルハドラッグ上溝店", address: "相模原市中央区上溝３７７９－１", lat: 35.597, lng: 139.400 },
  { name: "調剤薬局ツルハドラッグ相模原西橋本店", address: "相模原市緑区西橋本４－８－５５", lat: 35.598, lng: 139.401 },
  { name: "調剤薬局ツルハドラッグ相模原矢部店", address: "相模原市中央区矢部４－１４－９", lat: 35.599, lng: 139.402 },
  { name: "調剤薬局ツルハドラッグ相模原由野台店", address: "相模原市中央区由野台２－２８－１２", lat: 35.600, lng: 139.403 },
  { name: "調剤薬局ツルハドラッグ淵野辺駅前店", address: "相模原市中央区鹿沼台２－２１－１", lat: 35.601, lng: 139.404 },
  { name: "調剤薬局はっせんどう", address: "相模原市南区古淵２－１８－３　山政第１ビル１Ｆ", lat: 35.554, lng: 139.426 },
  { name: "ちよだ薬局", address: "相模原市中央区千代田４－４－１０", lat: 35.602, lng: 139.405 },
  { name: "つくいメロン薬局", address: "相模原市緑区中野２２２－２", lat: 35.620, lng: 139.323 },
  { name: "東光ドラッグ東林間店", address: "相模原市南区上鶴間７－８－１", lat: 35.555, lng: 139.427 },
  { name: "トーザイ薬局", address: "相模原市南区若松３－３３－１３", lat: 35.556, lng: 139.428 },
  { name: "東聖薬局相模原店", address: "相模原市中央区富士見６－４－１５", lat: 35.603, lng: 139.406 },
  { name: "東林メディカル薬局", address: "相模原市南区上鶴間７－２－１１　プライムコート2号室", lat: 35.557, lng: 139.429 },
  { name: "徳永薬局相武台在宅センター", address: "相模原市南区相武台１－２６－１３コーポあーさ相武台１Ｆ", lat: 35.515, lng: 139.388 },
  { name: "とく薬局", address: "相模原市中央区千代田６－３－２２", lat: 35.604, lng: 139.407 },
  { name: "ドラッグセイムス麻溝台薬局", address: "相模原市南区麻溝台５－１５－４", lat: 35.558, lng: 139.430 },
  { name: "ドラッグセイムス相模台薬局", address: "相模原市南区相模台２－２－１　片野ビル１階", lat: 35.559, lng: 139.431 },
  { name: "ドラッグセイムス相模原新磯野薬局", address: "相模原市南区新磯野３－２９－３", lat: 35.560, lng: 139.432 },
  { name: "ドラッグセイムス作の口薬局", address: "神奈川県相模原市中央区上溝４４０９－１", lat: 35.605, lng: 139.408 },
  { name: "ドラッグセイムス南橋本薬局", address: "相模原市中央区南橋本１－１４－４", lat: 35.606, lng: 139.409 },
  { name: "ななほし薬局上鶴間店", address: "相模原市南区上鶴間本町９－２－１５Ｆ．ｓｋｙｐａｒｋ１０２", lat: 35.561, lng: 139.433 },
  { name: "なの花薬局上溝駅前店", address: "相模原市中央区上溝３１７５－１", lat: 35.607, lng: 139.410 },
  { name: "なの花薬局相模原星が丘店", address: "相模原市中央区星が丘１－１－３", lat: 35.608, lng: 139.411 },
  { name: "南山堂フジ薬局", address: "相模原市中央区淵野辺３－２－１８", lat: 35.609, lng: 139.412 },
  { name: "南山堂薬局相模原店", address: "相模原市緑区大島８６６－３", lat: 35.621, lng: 139.324 },
  { name: "南山堂薬局城山店", address: "相模原市緑区川尻１４２３－１", lat: 35.622, lng: 139.325 },
  { name: "日本調剤麻溝薬局", address: "相模原市南区麻溝台１－２－１１", lat: 35.562, lng: 139.434 },
  { name: "日本調剤北里薬局", address: "相模原市南区麻溝台１－２－２３", lat: 35.563, lng: 139.435 },
  { name: "日本調剤相模大野薬局", address: "相模原市南区相模大野３－１６－１１　大矢ビル１Ｆ", lat: 35.564, lng: 139.436 },
  { name: "日本調剤相模原薬局", address: "相模原市中央区相模原４－１－２０　アルファビル１階", lat: 35.610, lng: 139.413 },
  { name: "日本調剤新相模原薬局", address: "相模原市中央区相模原４－１－２１", lat: 35.611, lng: 139.414 },
  { name: "日本調剤津久井薬局", address: "相模原市緑区中野２６６－３", lat: 35.623, lng: 139.326 },
  { name: "のざき薬局", address: "相模原市緑区小渕１７０７", lat: 35.624, lng: 139.327 },
  { name: "のぞみ薬局", address: "相模原市中央区矢部３－１－１９", lat: 35.612, lng: 139.415 },
  { name: "のぞみ薬局矢部２号店", address: "相模原市中央区矢部３－１－１０", lat: 35.613, lng: 139.416 },
  { name: "橋本調剤薬局", address: "相模原市緑区橋本６－３１－２", lat: 35.625, lng: 139.328 },
  { name: "橋本ひかり薬局", address: "相模原市緑区橋本2－3－7", lat: 35.626, lng: 139.329 },
  { name: "はづき薬局下九沢店", address: "相模原市中央区下九沢９４５－１", lat: 35.614, lng: 139.417 },
  { name: "はづき薬局矢部店", address: "相模原市中央区矢部３－１８－８　プラザ矢部１F", lat: 35.615, lng: 139.418 },
  { name: "原田薬局", address: "相模原市緑区下九沢１７４４－９", lat: 35.627, lng: 139.330 },
  { name: "阪神調剤薬局相模原協同病院前店", address: "相模原市緑区橋本台４－３－２", lat: 35.628, lng: 139.331 },
  { name: "東橋本薬局", address: "相模原市緑区東橋本２－１９－９", lat: 35.629, lng: 139.332 },
  { name: "東林間薬局西口店", address: "相模原市南区上鶴間７－６－４", lat: 35.565, lng: 139.437 },
  { name: "東林間薬局", address: "相模原市南区上鶴間５－８－１１", lat: 35.566, lng: 139.438 },
  { name: "ヒキチ薬局", address: "相模原市南区御園２－６－１－１", lat: 35.567, lng: 139.439 },
  { name: "ヒキチ調剤薬局", address: "相模原市南区麻溝台５－１８－１", lat: 35.568, lng: 139.440 },
  { name: "ひとみ薬局", address: "相模原市南区相模大野５－９－１９", lat: 35.569, lng: 139.441 },
  { name: "ひなた薬局東林間店", address: "相模原市南区東林間７－１－１", lat: 35.570, lng: 139.442 },
  { name: "ひばり薬局", address: "相模原市中央区東淵野辺５－８－１２", lat: 35.616, lng: 139.419 },
  { name: "ひばり薬局相模原店", address: "相模原市南区南台６－８－１５　メディカルビル１０１", lat: 35.571, lng: 139.443 },
  { name: "ひまわり調剤薬局", address: "相模原市南区上鶴間本町１－３８－３２", lat: 35.572, lng: 139.444 },
  { name: "ヒライ薬局", address: "相模原市南区御園２－１３－５", lat: 35.573, lng: 139.445 },
  { name: "ビリーブ薬局", address: "相模原市中央区横山台2-5-1", lat: 35.617, lng: 139.420 },
  { name: "淵野辺スマイル薬局", address: "相模原市中央区鹿沼台２－１８－６", lat: 35.618, lng: 139.421 },
  { name: "渕野辺ゾウサン薬局", address: "相模原市中央区淵野辺３－１７－７", lat: 35.619, lng: 139.422 },
  { name: "渕野辺ゾウサン薬局南口店", address: "相模原市中央区鹿沼台１－１５－１９　１Ｆ", lat: 35.620, lng: 139.423 },
  { name: "渕野辺薬局", address: "相模原市中央区鹿沼台２－１０－１５　第２ＳＫビル１階１号室", lat: 35.621, lng: 139.424 },
  { name: "プライム薬局橋本駅前店", address: "相模原市緑区橋本３－１４－１　マイランドⅡ橋本メディカルビル１Ｆ", lat: 35.630, lng: 139.333 },
  { name: "ブルーム薬局上溝店", address: "相模原市中央区上溝４－１４－６", lat: 35.622, lng: 139.425 },
  { name: "フロンティア薬局麻溝台店", address: "相模原市南区麻溝台１－２－１０", lat: 35.574, lng: 139.446 },
  { name: "平安堂薬局", address: "相模原市南区東林間５－８－１", lat: 35.575, lng: 139.447 },
  { name: "星が丘西薬局", address: "相模原市中央区横山３－３１－１３　エリオス１Ｆ", lat: 35.623, lng: 139.426 },
  { name: "ポプラ調剤薬局", address: "相模原市南区南台６－８－２０", lat: 35.576, lng: 139.448 },
  { name: "ポプラ薬局", address: "相模原市南区東林間４－９－６　伸和ビル１F", lat: 35.577, lng: 139.449 },
  { name: "本町薬局", address: "相模原市中央区淵野辺本町２－５－１７　ローレルハイツ１０１", lat: 35.624, lng: 139.427 },
  { name: "まいにち薬局", address: "相模原市南区古淵２－１６－１５　マスカットビル", lat: 35.578, lng: 139.450 },
  { name: "まごころ薬局相模大野店", address: "相模原市南区相模大野３－１１－１０　クレスト三喜１Ｆ", lat: 35.579, lng: 139.451 },
  { name: "まごころ薬局城山店", address: "相模原市緑区原宿５－２３－２７", lat: 35.631, lng: 139.334 },
  { name: "まりも薬局", address: "相模原市南区新磯野３－３０－１　鈴木ビル１Ｆ", lat: 35.580, lng: 139.452 },
  { name: "みすず薬局", address: "相模原市中央区横山４－２３－２１", lat: 35.625, lng: 139.428 },
  { name: "緑が丘薬局", address: "相模原市中央区緑が丘２－２８－１", lat: 35.626, lng: 139.429 },
  { name: "みどり調剤薬局", address: "相模原市緑区三ケ木２６５－１", lat: 35.632, lng: 139.335 },
  { name: "みどり薬局", address: "相模原市緑区橋本５－６－１９", lat: 35.633, lng: 139.336 },
  { name: "みどり薬局", address: "相模原市中央区淵野辺１－１－４", lat: 35.627, lng: 139.430 },
  { name: "みどり薬局光が丘店", address: "相模原市中央区光が丘３－７－４", lat: 35.628, lng: 139.431 },
  { name: "南台薬局", address: "相模原市南区南台５－１６－１２", lat: 35.581, lng: 139.453 },
  { name: "宮之前薬局駅前店", address: "相模原市緑区橋本６－２－３", lat: 35.634, lng: 139.337 },
  { name: "みよの台薬局相模大野店", address: "相模原市南区相模大野６－２－９", lat: 35.582, lng: 139.454 },
  { name: "めぐみ薬局アリオ橋本店", address: "相模原市緑区大山町１－２２　アリオ橋本１０６－２", lat: 35.635, lng: 139.338 },
  { name: "めぐみ薬局上溝店", address: "相模原市中央区上溝３９５６－１", lat: 35.629, lng: 139.432 },
  { name: "めぐみ薬局ダイエー上溝店", address: "相模原市中央区上溝５－１４－１９　ダイエー上溝店１F", lat: 35.630, lng: 139.433 },
  { name: "めぐみ薬局淵野辺本町店", address: "相模原市中央区淵野辺本町２－５－１８", lat: 35.631, lng: 139.434 },
  { name: "森のくまさん薬局", address: "相模原市緑区西橋本５－１－１", lat: 35.636, lng: 139.339 },
  { name: "森のくまさん薬局橋本駅前店", address: "相模原市緑区橋本３－２０－５　一新ビル1階", lat: 35.637, lng: 139.340 },
  { name: "薬苑橋本薬局", address: "相模原市緑区橋本３－１５－２　ダイアパレスステーションプラザ橋本１０１", lat: 35.638, lng: 139.341 },
  { name: "薬樹薬局相模原", address: "相模原市中央区相模原８－１－１　プレステージさがみ夢大通り１階１０２号室", lat: 35.632, lng: 139.435 },
  { name: "薬樹薬局矢部", address: "相模原市中央区淵野辺１－２－３１　デルフィー矢部１階", lat: 35.633, lng: 139.436 },
  { name: "薬局アクアファーマシー", address: "相模原市緑区橋本３－２８－１　ミウィ橋本１階", lat: 35.639, lng: 139.342 },
  { name: "薬局マツモトキヨシ相模大野ステーションスクエア店", address: "相模原市南区相模大野３－８－１", lat: 35.583, lng: 139.455 },
  { name: "薬局マツモトキヨシ相模原麻溝店", address: "相模原市南区下溝７５６－６", lat: 35.584, lng: 139.456 },
  { name: "薬局マツモトキヨシ相模原宮下本町店", address: "相模原市中央区宮下本町１－３１－１３", lat: 35.634, lng: 139.437 },
  { name: "薬局マツモトキヨシ相模原陽光台店", address: "相模原市中央区陽光台３－１８－１７", lat: 35.635, lng: 139.438 },
  { name: "薬局マツモトキヨシ古淵駅前店", address: "相模原市南区古淵１－９－１８", lat: 35.585, lng: 139.457 },
  { name: "薬局マツモトキヨシ淵野辺店", address: "相模原市中央区淵野辺２－６－３０", lat: 35.636, lng: 139.439 },
  { name: "矢部薬局", address: "相模原市中央区矢部２－２９－１２", lat: 35.637, lng: 139.440 },
  { name: "ヤマグチ薬局相原店", address: "相模原市緑区相原５－１－２", lat: 35.640, lng: 139.343 },
  { name: "ヤマグチ薬局内郷店", address: "相模原市緑区若柳１２０９－１", lat: 35.641, lng: 139.344 },
  { name: "ヤマグチ薬局大野北口店", address: "相模原市南区相模大野３－１５－２２　ＬＯＣ'Ｓ　ＳＡＧＡＭＩ－ＯＮＯ　Ｂ棟１Ｆ", lat: 35.586, lng: 139.458 },
  { name: "ヤマグチ薬局鹿沼台店", address: "相模原市中央区鹿沼台２－１８－２", lat: 35.638, lng: 139.441 },
  { name: "ヤマグチ薬局北橋本店", address: "相模原市緑区橋本６－２６－１４　メゾングランデ１－Ａ", lat: 35.642, lng: 139.345 },
  { name: "ヤマグチ薬局串川店", address: "相模原市緑区長竹１１８６－２", lat: 35.643, lng: 139.346 },
  { name: "ヤマグチ薬局下九沢店", address: "相模原市緑区下九沢１９１２－１－Ｂ", lat: 35.644, lng: 139.347 },
  { name: "ヤマグチ薬局下溝店", address: "相模原市南区下溝３１７－５", lat: 35.587, lng: 139.459 },
  { name: "ヤマグチ薬局城山店", address: "相模原市緑区久保沢２－３－２２", lat: 35.645, lng: 139.348 },
  { name: "ヤマグチ薬局千代田店", address: "相模原市中央区千代田３－２－１８　藤野ビル1階", lat: 35.639, lng: 139.442 },
  { name: "ヤマグチ薬局津久井中野店", address: "相模原市緑区中野２１８－８　ヤマニ津久井ビル１Ｆ", lat: 35.646, lng: 139.349 },
  { name: "ヤマグチ薬局西橋本店", address: "相模原市緑区西橋本２－１－８", lat: 35.647, lng: 139.350 },
  { name: "ヤマグチ薬局二本松店", address: "相模原市緑区二本松１－３－９", lat: 35.648, lng: 139.351 },
  { name: "ヤマグチ薬局橋本３丁目店", address: "相模原市緑区橋本３－１９－２０　ＮＢＫビル１Ｆ", lat: 35.649, lng: 139.352 },
  { name: "ヤマグチ薬局橋本４丁目店", address: "相模原市緑区橋本４－１８－１３　ヴィラベルヴュー１０１", lat: 35.650, lng: 139.353 },
  { name: "ヤマグチ薬局橋本７丁目店", address: "相模原市緑区橋本７－４－２１", lat: 35.651, lng: 139.354 },
  { name: "ヤマグチ薬局橋本８丁目店", address: "相模原市緑区橋本８－２－１", lat: 35.652, lng: 139.355 },
  { name: "ヤマグチ薬局原宿店", address: "相模原市緑区原宿５－１－１１", lat: 35.653, lng: 139.356 },
  { name: "ヤマグチ薬局東橋本店", address: "相模原市緑区東橋本１－５－１３", lat: 35.654, lng: 139.357 },
  { name: "ヤマグチ薬局東橋本２号店", address: "相模原市緑区東橋本３－１－５", lat: 35.655, lng: 139.358 },
  { name: "ヤマグチ薬局東林間店", address: "相模原市南区東林間５－１３－７－１Ｆ", lat: 35.588, lng: 139.460 },
  { name: "ヤマグチ薬局氷川店", address: "相模原市中央区氷川町９－１１", lat: 35.640, lng: 139.443 },
  { name: "ヤマグチ薬局淵野辺店", address: "相模原市中央区淵野辺１－１０－１３　ライオンズマンション淵野辺１階１０１号", lat: 35.641, lng: 139.444 },
  { name: "ヤマグチ薬局本町店", address: "相模原市南区上鶴間本町８－４４－２１", lat: 35.589, lng: 139.461 },
  { name: "ヤマグチ薬局本店", address: "相模原市緑区橋本２－９－６", lat: 35.656, lng: 139.359 },
  { name: "ヤマグチ薬局南台店", address: "相模原市南区南台６－８－２０", lat: 35.590, lng: 139.462 },
  { name: "ヤマグチ薬局矢部店", address: "相模原市中央区淵野辺１－２－３３", lat: 35.642, lng: 139.445 },
  { name: "ヤマグチ薬局横山店", address: "相模原市中央区横山５－２－１５", lat: 35.643, lng: 139.446 },
  { name: "ヤマシタ薬局", address: "相模原市中央区中央３－７－２", lat: 35.644, lng: 139.447 },
  { name: "ユニスマイル薬局相模大野店", address: "相模原市南区相模大野７－６－１３", lat: 35.591, lng: 139.463 },
  { name: "横田薬局", address: "相模原市中央区淵野辺３－９－１７－１０１", lat: 35.645, lng: 139.448 },
  { name: "由野台薬局", address: "相模原市中央区由野台１－２３－８", lat: 35.646, lng: 139.449 },
  { name: "りぼん薬局", address: "相模原市南区若松５－２４－７", lat: 35.592, lng: 139.464 },
  { name: "るりこし薬局", address: "相模原市中央区上溝３９２６－１０", lat: 35.647, lng: 139.450 },
  { name: "れもん薬局", address: "相模原市南区相南４－１７－１１", lat: 35.593, lng: 139.465 },
  { name: "ローソンクオール薬局相模大野北口店", address: "相模原市南区相模大野３－３－１－２０１", lat: 35.594, lng: 139.466 },
  { name: "有限会社わかば調剤薬局", address: "相模原市南区相模台２－１８－１１", lat: 35.595, lng: 139.467 },
  { name: "わかば薬局上九沢店", address: "相模原市緑区上九沢４　市営上九沢団地Ｉ棟１Ｆ", lat: 35.657, lng: 139.360 },
  { name: "わかば薬局相模大野", address: "相模原市南区上鶴間１－４－２７", lat: 35.596, lng: 139.468 },
  { name: "わかば薬局相模原緑店", address: "相模原市緑区大島１５８６－１", lat: 35.658, lng: 139.361 },
  { name: "わかば薬局橋本店", address: "相模原市緑区橋本５－４－５", lat: 35.659, lng: 139.362 },
  { name: "ak薬局相模大野店", address: "相模原市南区相模大野６－１９－１７", lat: 35.597, lng: 139.469 }
            ]
        };

        // 事前読み込み済みデータから即座にマーカー表示
        function loadPreloadedData() {
            const datasets = [
                { 
                    data: preloadedData.sagamiharaHospitals, 
                    name: '相模原市自立支援医療機関（病院）', 
                    type: 'hospital',
                    color: '#f44336' 
                },
                { 
                    data: preloadedData.sagamiharaPharmacies, 
                    name: '相模原市自立支援医療機関（薬局）', 
                    type: 'pharmacy',
                    color: '#2196f3' 
                }
            ];

            datasets.forEach(dataset => {
                const layer = makeLayerWithType(dataset.name, dataset.type, dataset.color);
                
                dataset.data.forEach((item, index) => {
                    // 座標が既に指定されているので直接マーカー追加
                    addMarker(layer, item.name, item.address, item.lat, item.lng);
                    layer.stats.success++;
                    globalStats.success++;
                    globalStats.total++;
                });

                layer.stats.total = dataset.data.length;
                console.log(`${dataset.name}: ${dataset.data.length}件のマーカーを表示しました`);
            });

            updateStats();
            renderLayerList();
            fitToVisibleBounds();
        }

        // サンプルデータ読み込み
        function loadSampleData() {
            const sampleData = [
                { name: "本社", address: "東京都千代田区千代田1-1" },
                { name: "倉庫", address: "神奈川県川崎市麻生区王禅寺東" }
            ];

            const layer = makeLayer("サンプルデータ");
            const rows = sampleData.map((item, index) => ({
                name: item.name,
                address: item.address,
                lat: null,
                lng: null,
                rowNumber: index + 1
            }));

            layer.stats.total = rows.length;
            addLayerFromRows(layer, rows, "サンプルデータ");
        }
    </script>

    <!-- Google Maps API 読み込み -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCk362YNjFjHr1Z8af2VcRdLH51SKhVSbY&language=ja&callback=initMap"></script>
</body>
</html>

<!--
GitHub Pages デプロイ手順:
1. このファイルをリポジトリ直下に index.html として配置
2. GitHub リポジトリの Settings → Pages → Source で "Deploy from a branch" を選択
3. Branch で "main" (またはメインブランチ) を選択
4. 数十秒後に公開 URL が発行されます
5. Google Maps API キーを YOUR_API_KEY から実際のキーに差し替えてください
6. API キーには HTTP リファラ制限（GitHub Pages の公開 URL）を設定することを推奨します
7. URL を共有して利用してください（検索エンジンを避けたい場合は head に <meta name="robots" content="noindex"> を追加可能）
-->